using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Data;
using System.Text;
using System.Windows.Forms;
using Maticsoft.Common.Util;

namespace Demo
{
    public partial class TabConfig : UserControl
    {
        Point location = new Point(15, 10);
        private ItemMenuButtom configBtn = new ItemMenuButtom();
        //写成公有对象 因为该控件clear的时候 串口需要关闭
        UnitConfigCMDTest unitConfigCMDTest = null;

        public TabConfig()
        {
            InitializeComponent();
        }

        private void TabConfig_Load(object sender, EventArgs e)
        {
            //查询保留字段表 确定打印通道
            Maticsoft.Controller.ReservedFieldsController con = new Maticsoft.Controller.ReservedFieldsController();
            Maticsoft.Common.model.reserved_fields rf = con.getReservedFields("IS_PRINT_SCAN_IMAGE");

            if (rf.value.Equals("0"))
            {
                this.radBtnPrintingChanel01.Checked = true;
            }
            else
            {
                this.radBtnPrintingChanel02.Checked = true;
            }

            this.radBtnPrintingChanel01.CheckedChanged += new System.EventHandler(this.radBtnPrintingChanel01_CheckedChanged);
            this.radBtnPrintingChanel02.CheckedChanged += new System.EventHandler(this.radBtnPrintingChanel02_CheckedChanged);

            UnitMyConfig unitMyConfig = new UnitMyConfig();
            unitMyConfig.Location = location;
            this.configSettingAreaPanel.Controls.Add(unitMyConfig);
            AddEvents();
            this.menuControlsList.HideScrollbar = true;
        }

        /// <summary>
        /// 添加标签的点击事件
        /// </summary>
        private void AddEvents()
        {
            ItemMenuButtom mbcs = new ItemMenuButtom("CONFIG_SYSTEM", "系统设置");
            mbcs.clickHandler += new EventHandler(delegate(object sender, EventArgs e)
            {
                ClosePort();
                Selected(sender);
                this.configSettingAreaPanel.Controls.Clear();
                UnitMyConfig unitMyConfig = new UnitMyConfig();
                unitMyConfig.Location = location;
                this.configSettingAreaPanel.Controls.Add(unitMyConfig);
            });
            Selected(mbcs);
            this.menuControlsList.Add(mbcs);

            ItemMenuButtom mbcm = new ItemMenuButtom("CONFIG_MACHINE", "我的彩机");
            mbcm.clickHandler += new EventHandler(delegate(object sender, EventArgs e)
            {
                ClosePort();
                Selected(sender);
                this.configSettingAreaPanel.Controls.Clear();
                UnitConfigStoreMachine ucsm = new UnitConfigStoreMachine();
                ucsm.Location = location;
                this.configSettingAreaPanel.Controls.Add(ucsm);
            });
            this.menuControlsList.Add(mbcm);

            ItemMenuButtom mbceh = new ItemMenuButtom("CONFIG_ERROR_HANDLER", "错误设置");
            mbceh.clickHandler += new EventHandler(delegate(object sender, EventArgs e)
            {
                ClosePort();
                Selected(sender);
                this.configSettingAreaPanel.Controls.Clear();
                UnitConfigErrorHandlerPage u =new UnitConfigErrorHandlerPage();
                u.Location = new Point(15,0);
                this.configSettingAreaPanel.Controls.Add(u);
            });
            this.menuControlsList.Add(mbceh);

            ItemMenuButtom imbAudio = new ItemMenuButtom("CONFIG_AUDIO", "音频设置");
            imbAudio.clickHandler += new EventHandler(delegate(object sender, EventArgs e)
            {
                ClosePort();
                Selected(sender);
                this.configSettingAreaPanel.Controls.Clear();
                UnitConfigAudio u = new UnitConfigAudio();
                u.Location = new Point(15, 0);
                this.configSettingAreaPanel.Controls.Add(u);
            });
            this.menuControlsList.Add(imbAudio);

            ItemMenuButtom mbcmd = new ItemMenuButtom("CONFIG_CMD_TEST", "命令测试");
            mbcmd.clickHandler += new EventHandler(delegate(object sender, EventArgs e)
            {
                ClosePort();
                Selected(sender);
                this.configSettingAreaPanel.Controls.Clear();
                //UnitConfigCMDTest unitConfigCMDTest = new UnitConfigCMDTest();
                unitConfigCMDTest = new UnitConfigCMDTest();
                unitConfigCMDTest.Location = new Point(-2, 0);
                this.configSettingAreaPanel.Controls.Add(unitConfigCMDTest);
            });
            this.menuControlsList.Add(mbcmd);
        }

        //关闭UnitConfigCMDTest控件的串口
        public void ClosePort()
        {
            if (unitConfigCMDTest != null)
            {
                unitConfigCMDTest.ClosePort();
                unitConfigCMDTest = null;
            }
        }

        private void Selected(object sender)
        {
            Control c = (Control)sender;
            while (c.GetType() != typeof(ItemMenuButtom))
            {
                c = c.Parent;
            }
            configBtn = c as ItemMenuButtom;
            foreach (ItemMenuButtom btnMenu in this.menuControlsList.ControlList.Controls)
            {
                if (btnMenu.Selected)
                {
                    btnMenu.Selected = false;
                }
            }
            configBtn.Selected = true;
        }

        private void radBtnPrintingChanel01_CheckedChanged(object sender, EventArgs e)
        {
            RadioButton rb = sender as RadioButton;
            if (rb.Checked)
            {
                Maticsoft.Controller.ReservedFieldsController con = new Maticsoft.Controller.ReservedFieldsController();
                try
                {
                    con.updateReservedFields("IS_PRINT_SCAN_IMAGE", "0");
                    Maticsoft.Common.model.reserved_fields rf = new Maticsoft.Controller.ReservedFieldsController().getReservedFields("IS_PRINT_SCAN_IMAGE");
                    Maticsoft.BLL.ScanPortImage.SPImageGlobal.IS_PRINT_SCAN_IMAGE = rf.value.Equals("1") ? true : false;
                }
                catch (Exception)
                {

                    throw;
                }
            }
        }

        private void radBtnPrintingChanel02_CheckedChanged(object sender, EventArgs e)
        {
            RadioButton rb = sender as RadioButton;
            if (rb.Checked)
            {
                Maticsoft.Controller.ReservedFieldsController con = new Maticsoft.Controller.ReservedFieldsController();
                try
                {
                    con.updateReservedFields("IS_PRINT_SCAN_IMAGE", "1");
                    Maticsoft.Common.model.reserved_fields rf = new Maticsoft.Controller.ReservedFieldsController().getReservedFields("IS_PRINT_SCAN_IMAGE");
                    Maticsoft.BLL.ScanPortImage.SPImageGlobal.IS_PRINT_SCAN_IMAGE = rf.value.Equals("1") ? true : false;
                }
                catch (Exception)
                {

                    throw;
                }
            }
        }
    }
}
